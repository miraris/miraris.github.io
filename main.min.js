'use strict';var _createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,'value'in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var canvas=document.getElementById('mainCanvas'),ctx=canvas.getContext('2d');function chunk(a,b){for(var c=[],d=0,f=a.length;d<f;d+=b)c.push(a.slice(d,d+b));return c}var API_URL='https://api.miraris.moe',getImage=function(){return fetch(API_URL).then(function(a){return a.json()})},Sketcher=function(){function a(b){_classCallCheck(this,a);var c=JSON.parse(b);this.data=c,this.cur=0,this.coords=[],this.max=0,this.lightness=50}return _createClass(a,[{key:'clear',value:function clear(){this.cur=0,ctx.clearRect(0,0,canvas.width,canvas.height)}},{key:'setLightness',value:function setLightness(b){this.lightness=b}},{key:'getLightness',value:function getLightness(){return this.lightness}},{key:'resize',value:function resize(){var b=this.data[0],c=this.size.width/2-(Math.max.apply(Math,_toConsumableArray(b))-Math.min.apply(Math,_toConsumableArray(b)))/2;return chunk(this.data.map(function(d){return[d[0]+c,d[1]]}),this.data.length/500)}},{key:'setSize',value:function setSize(b){this.size=b,this.coords=this.resize(),this.max=this.coords.length}},{key:'draw',value:function draw(){var k=this;if(!(this.cur>=this.max)){for(var b=this.coords[this.cur],c=0;c<b.length;c++){var d=b[c],f=360*(d[0]/canvas.width),g=100-d[1]/canvas.height;ctx.fillStyle='hsla('+f+', '+g+'%, '+this.lightness+'%, 0.4)',ctx.fillRect(d[0],d[1],1,1)}this.cur++,requestAnimationFrame(function(){return k.draw()})}}}]),a}(),resizeCanvas=function(a){var b={width:window.innerWidth,height:window.innerHeight};canvas.width=b.width,canvas.height=b.height,a.setSize(b),a.clear(),a.draw()};getImage().then(function(a){var b=a[0].data,c=new Sketcher(b),d=new CustomEvent('customResize',{detail:c});window.addEventListener('customResize',function(f){return resizeCanvas(f.detail)}),window.addEventListener('resize',function(){return window.dispatchEvent(d)}),resizeCanvas(c)});
